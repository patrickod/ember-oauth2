/** ember-oauth2 | @version 0.5.1 | 12-09-2014 */
!function(){var a,b,c,d;!function(){function e(a,b,d){for(var e,g,h=a.length,i=new Array(h),j=0,k=h;k>j;j++)e=a[j],"exports"===e?g=i[j]=d:i[j]=c(f(e,b));return{deps:i,exports:g}}function f(a,b){if("."!==a.charAt(0))return a;var c,d=a.split("/"),e=b.split("/");c=1===e.length?e:e.slice(0,-1);for(var f=0,g=d.length;g>f;f++){var h=d[f];if(".."===h)c.pop();else{if("."===h)continue;c.push(h)}}return c.join("/")}var g={},h={},i={},j=!1;a=function(a,b,c){g[a]={deps:b,callback:c}},d=c=b=function(a){if(i[a]!==j&&h.hasOwnProperty(a))return h[a];if(!g[a])throw new Error("Could not find module "+a);var b,c,d=g[a],f=!1;h[a]={};try{b=e(d.deps,a,h[a]),c=d.callback.apply(this,b.deps),f=!0}finally{f||(i[a]=j)}return b.exports?h[a]:h[a]=c},d.entries=d._eak_seen=g,d.clear=function(){d.entries=d._eak_seen=g={},h=i={}}}(),a("ember-oauth2",["ember","exports"],function(a,b){"use strict";var c=a["default"];b["default"]=c.Object.extend(c.Evented,{init:function(){this._super(),c.OAuth2&&c.OAuth2.config&&Object.keys(c.OAuth2.config).length?(c.Logger.warn("Ember.OAuth2.config is deprecated and will be removed in future versions. Set the config using window.ENV['ember-oauth2']"),this.providerConfig=c.OAuth2.config[this.get("providerId")]):this.providerConfig=window.ENV["ember-oauth2"][this.get("providerId")],this.set("statePrefix","state"),this.set("tokenPrefix","token"),this.setProperties(this.providerConfig),this.on("redirect",this.handleRedirect),this.on("success",this._onSuccess),this.on("error",this._onError)},version:function(){return d},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})},now:function(){return Math.round((new Date).getTime()/1e3)},requestObj:function(){var a={response_type:"token"};return a.providerId=this.get("providerId"),a.state=this.get("state"),a.client_id=this.get("clientId"),a.state=this.get("state"),this.get("scope")&&(a.scope=this.get("scope")),a},authUri:function(){this.get("state")||this.set("state",this.uuid());var a=this.get("authBaseUri");return a+="?response_type=token&redirect_uri="+encodeURIComponent(this.get("redirectUri"))+"&client_id="+encodeURIComponent(this.get("clientId"))+"&state="+encodeURIComponent(this.get("state")),this.get("scope")&&(a+="&scope="+encodeURIComponent(this.get(".scope")).replace("%20","+")),a},authorize:function(){if(!this.get("providerId"))throw new Error("No provider id given.");if(!this.get("clientId"))throw new Error("No client id given.");if(!this.get("authBaseUri"))throw new Error("No auth base uri given.");if(!this.get("redirectUri"))throw new Error("No redirect uri given.");var a=this.authUri();return this.clearStates(),this.saveState(this.get("state"),this.requestObj()),this.openWindow(a)},openWindow:function(a){var b=600,d=800,e=window.screen.width/2-b/2,f=window.screen.height/2-d/2,g="menubar, width="+b+", height="+d+", top="+f+", left="+e,h=window.open(a,"Authorize",g);window.focus&&h&&h.focus();return new c.RSVP.Promise(function(a,b){h?a(h):b(new Error("Opening dialog login window failed."))})},authSuccess:function(a){return a.access_token},generateToken:function(a){var b={};return b.provider_id=this.get("providerId"),b.expires_in=this.expiresIn(a.expires_in),b.scope=this.get("scope"),b.access_token=a.access_token,b},expiresIn:function(a){return this.now()+parseInt(a,10)},onRedirect:function(a,b){c.Logger.warn("Ember.OAuth2.onRedirect is deprecated and will be removed in future versions. Please use .trigger('redirect') instead."),this.trigger("redirect",a,b)},handleRedirect:function(a,b){var c=this.parseCallback(a);if(this.authSuccess(c)){var d=this.getState(c.state);this.checkState(d),this.saveToken(this.generateToken(c)),this.trigger("success",d)}else this.trigger("error",c);b&&"function"==typeof b&&b()},_onSuccess:function(a){"function"==typeof this.onSuccess&&(c.Logger.warn("Ember.OAuth2.onSuccess is deprecated and will be removed in future versions. Bind your callbacks using .on('success', fn) instead."),this.onSuccess(a))},_onError:function(a){"function"==typeof this.onError&&(c.Logger.warn("Ember.OAuth2.onError is deprecated and will be removed in furture versions. Bind your callbacks using .on('error', fn) instead."),this.onError(a))},checkState:function(a){if(!a)throw new Error("Could not find state.");if(a.state!==this.get("state"))throw new Error("State returned from the server did not match the local saved state.")},parseCallback:function(a){for(var b,c={},d=a.substring(1),e=/([^#?&=]+)=([^&]*)/g;null!==(b=e.exec(d));)c[decodeURIComponent(b[1])]=decodeURIComponent(b[2]);return c},saveState:function(a,b){window.localStorage.setItem(this.get("statePrefix")+"-"+a,JSON.stringify(b))},getState:function(a){var b=JSON.parse(window.localStorage.getItem(this.get("statePrefix")+"-"+a));return window.localStorage.removeItem(this.get("statePrefix")+"-"+a),b},clearStates:function(){for(var a,b=new RegExp("^"+this.get("statePrefix")+"-.*","g"),c=[],d=0,e=window.localStorage.length;e>d;d++)a=window.localStorage.key(d),a.match(b)&&c.push(a);for(var f=0,g=c.length;g>f;f++)a=c[f],window.localStorage.removeItem(a);return c},saveToken:function(a){window.localStorage.setItem(this.get("tokenPrefix")+"-"+this.get("providerId"),JSON.stringify(a))},getToken:function(){var a=JSON.parse(window.localStorage.getItem(this.get("tokenPrefix")+"-"+this.get("providerId")));return a&&a.access_token?a:null},getAccessToken:function(){var a=this.getToken();return a?a.access_token:null},accessTokenIsExpired:function(){var a=this.getToken();return a?this.now()>=a.expires_in?!0:!1:!0},expireAccessToken:function(){var a=this.getToken();return a?(a.expires_in=0,void this.saveToken(a)):null}});var d="0.5.1";c.OAuth2&&(c.OAuth2.version=d)}),a("ember",[],function(){"use strict";return{"default":Ember}}),window.Ember.OAuth2=b("ember-oauth2")["default"]}(window);